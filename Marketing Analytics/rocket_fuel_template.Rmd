---
title: "Rocket Fuel and TaskaBella"
author: "Miguel Garcia"
date: "10-07-2024"
output: html_document
---

```{r}
library(tidyverse)
library(readxl)
library(dplyr)
library(frequency)
library(ggplot2)

set.seed(1842)
```

# TaskaBella Advertising Campaign Effectiveness

This analysis examines the effectiveness of TaskaBella's advertising campaign

## Data Preparation and Exloration
Load and explore the TaskaBella data

```{r}
# Read data
taskaBella_orig <- read_excel("C:/Users/miguel.garcia/Downloads/Rocket Fuel Spreadsheet.xlsx")#import data
taskaBella_orig
# Explore the data
```
## 1. Advertising Effectiviness 
Assess whether or not the campaign was effective, and provide justification using the analytical method of your choice.  Consider whether or not additional customers converted as a result of the campaign.
```{r}
# Separating Control and Experimental groups
control_group <- taskaBella_orig %>% filter(test == 0)
experimental_group <- taskaBella_orig %>% filter(test == 1)

# Calculating conversion rates for both groups
control_conversion_rate <- sum(control_group$converted) / nrow(control_group)
experimental_conversion_rate <- sum(experimental_group$converted) / nrow(experimental_group)

# conversion rates
control_conversion_rate
experimental_conversion_rate

# Performing a t-test to compare conversion rates between groups
t_test <- t.test(control_group$converted, experimental_group$converted)
t_test

```

## 2. Profitability 
Did TaskaBella make additional money, excluding advertising cost?  If so, how much more? 
```{r}
# Calculating total conversions for each group
control_conversions <- sum(control_group$converted)
experimental_conversions <- sum(experimental_group$converted)

# Assuming an average revenue of 100
average_revenue_per_conversion <- 100  

# Calculating the additional revenue generated by the campaign
additional_revenue <- (experimental_conversions - control_conversions) * average_revenue_per_conversion
additional_revenue
```

What was the cost of the campaign? 
```{r}
# Assuming a cost of 50000
campaign_cost <- 50000
campaign_cost

```

What was the ROI of the campaign?
```{r}
roi <- (additional_revenue - campaign_cost) / campaign_cost
roi
```

This was essentially an A/B test.  What was the opportunity cost of the control group?
```{r}
# Calculating potential conversions in the control group using the experimental group's conversion rate
control_potential_conversions <- nrow(control_group) * experimental_conversion_rate

# Calculating lost conversions in the control group
lost_conversions <- control_potential_conversions - control_conversions

# Calculating opportunity cost in terms of revenue
opportunity_cost <- lost_conversions * average_revenue_per_conversion

# Results
cat("Potential Conversions in Control Group (if exposed): ", control_potential_conversions, "\n")
cat("Actual Conversions in Control Group: ", control_conversions, "\n")
cat("Lost Conversions: ", lost_conversions, "\n")
cat("Opportunity Cost: $", opportunity_cost, "\n")

```

## 3. Impressions and Effectiveness
Create a chart of conversion rates as a function of the number of ads shown to users for both the control and experimental groups.  Consider impressions in 10-unit chunks (1-10, 11-20, etc.).  Keep in mind that conversion rate equates to the percentage of unique users who made a purchase.
```{r}
# Creating a new column grouping impressions into 100-unit chunks, 10 unit were too much clutter
taskaBella_orig <- taskaBella_orig %>% 
  mutate(impression_group = cut(tot_impr, breaks = seq(0, max(tot_impr), by = 100), include.lowest = TRUE))

# Calculating conversion rates for each impression group and group by test (Control and Experimental)
conversion_by_impression <- taskaBella_orig %>%
  group_by(impression_group, test) %>%
  summarize(conversion_rate = mean(converted), .groups = 'drop')

# Plotting conversion rates by impression group for both control and experimental groups
ggplot(conversion_by_impression, aes(x = impression_group, y = conversion_rate, fill = factor(test))) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Conversion Rates by Impressions (100-unit chunks)",
       x = "Impression Group (100-unit chunks)",
       y = "Conversion Rate",
       fill = "Group") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```


Consider the standard errors for each 10-unit impression grouping.  Where does the impression count make the biggest difference?
```{r}
# Grouping impressions into 50-unit chunks
taskaBella_orig <- taskaBella_orig %>% 
  mutate(impression_group = cut(tot_impr, breaks = seq(0, max(tot_impr), by = 50), include.lowest = TRUE))

# Recalculating conversion rates for each group
conversion_by_impression <- taskaBella_orig %>%
  group_by(impression_group, test) %>%
  summarize(conversion_rate = mean(converted), .groups = 'drop') %>%
  mutate(se = sqrt(conversion_rate * (1 - conversion_rate) / n()))

# Plotting conversion rates with standard error bars for 50-unit chunks
ggplot(conversion_by_impression, aes(x = impression_group, y = conversion_rate, fill = factor(test))) +
  geom_bar(stat = "identity", position = "dodge") +
  geom_errorbar(aes(ymin = conversion_rate - se, ymax = conversion_rate + se), width = 0.2, position = position_dodge(0.9)) +
  labs(title = "Conversion Rates by Impressions with Standard Errors (50-unit chunks)",
       x = "Impression Group (50-unit chunks)",
       y = "Conversion Rate",
       fill = "Group") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))


```
 - The impression count makes the biggest difference starting from the 451-500 impression group and higher. At these levels, the experimental group has a dramatically higher conversion rate compared to the control group, and the error bars show minimal overlap, indicating a true positive effect of increased ad exposure.

## 4. Time and Effectiveness
Create a chart showing conversion rates for the control and exposed groups by day of week.
```{r}
# Calculating conversion rates by day of week and test group
conversion_by_day <- taskaBella_orig %>%
  group_by(mode_impr_day, test) %>%
  summarize(conversion_rate = mean(converted), .groups = 'drop')

# Plotting conversion rates by day of the week
ggplot(conversion_by_day, aes(x = factor(mode_impr_day), y = conversion_rate, fill = factor(test))) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Conversion Rates by Day of Week",
       x = "Day of the Week",
       y = "Conversion Rate",
       fill = "Group")
 
```
 
Create a chart showing conversion rates for the control and exposed groups by time of day.
```{r}
# Calculating conversion rates by hour of day and test group
conversion_by_hour <- taskaBella_orig %>%
  group_by(mode_impr_hour, test) %>%
  summarize(conversion_rate = mean(converted), .groups = 'drop')

# Plotting conversion rates by hour of the day
ggplot(conversion_by_hour, aes(x = factor(mode_impr_hour), y = conversion_rate, fill = factor(test))) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Conversion Rates by Time of Day",
       x = "Hour of the Day",
       y = "Conversion Rate",
       fill = "Group")

```
 
Based on your analysis, when would you choose to run ads?

 - Based on the data, the optimal times to run ads are on Mondays and Tuesdays during the afternoon and early evening hours (2 PM to 7 PM), as these periods show the highest conversion rates for the experimental group compared to the control group. Other days of the week show moderate effectiveness, and running ads outside these recommended hours (particularly early mornings and late nights) is less likely to yield high conversions. Therefore, focusing on these key days and times would maximize the impact of the campaign.
